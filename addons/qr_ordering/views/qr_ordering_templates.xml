<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!--
        Standalone Ordering Page Template
        å®Œå…¨ç‹¬ç«‹çš„ HTML æ–‡æ¡£ï¼Œä¸ä½¿ç”¨ä»»ä½• Odoo æ¨¡æ¿ï¼Œé¿å… #wrapwrap é—®é¢˜
    -->
    <template id="ordering_page" name="QR Ordering Page Standalone">
        <t t-set="html_data" t-value="{}"/>
        <html>
            <head>
                <meta charset="utf-8"/>
                <!-- viewport-fit=cover æ”¯æŒ iPhone X+ çš„ safe area -->
                <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
                <meta name="theme-color" content="#ff6b35"/>
                <!-- é˜²æ­¢ iOS è‡ªåŠ¨æ£€æµ‹ç”µè¯å·ç  -->
                <meta name="format-detection" content="telephone=no"/>
                <title>æ‰«ç ç‚¹é¤</title>

                <!-- ç§»åŠ¨ç«¯å…œåº• CSSï¼šè§£å†³ iOS Safari / å¾®ä¿¡æµè§ˆå™¨é«˜åº¦é—®é¢˜ -->
                <style type="text/css">
                    /* P0: ä¸‰æ®µå¼å¸ƒå±€ - html/body ä¸æ»šåŠ¨ï¼ˆå¼ºåˆ¶ï¼Œé˜²æ­¢å…¨å±€ CSS å¹²æ‰°ï¼‰ */
                    html, body {
                        height: 100% !important;
                        margin: 0 !important;
                        padding: 0 !important;
                        /* é»˜è®¤ä¸é”æ»šåŠ¨ï¼åªåœ¨å¼¹å±‚æ‰“å¼€æ—¶é€šè¿‡ JS æ·»åŠ  .qr-scroll-locked */
                        overflow: visible !important;
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                        background: #f5f5f5;
                        /* é˜²æ­¢ iOS åŒå‡»ç¼©æ”¾ */
                        touch-action: manipulation;
                        -webkit-tap-highlight-color: transparent;
                    }
                    /* P0: æ•´é¡µå®¹å™¨ï¼ˆä¸æ»šåŠ¨ï¼‰- å¼ºåˆ¶å¸ƒå±€ */
                    #qr-ordering-app {
                        width: 100% !important;
                        min-height: 100vh !important; /* fallback */
                        min-height: 100dvh !important; /* åŠ¨æ€è§†å£é«˜åº¦ï¼Œè‡ªåŠ¨é€‚åº”åœ°å€æ  */
                        display: flex !important;
                        flex-direction: column !important;
                        position: relative !important;
                        overflow: hidden !important; /* é¡µé¢å®¹å™¨ä¸æ»šåŠ¨ */
                    }
                    /* P0: å†…å®¹åŒºï¼ˆå”¯ä¸€æ»šåŠ¨å®¹å™¨ï¼‰- å¼ºåˆ¶æ»šåŠ¨ */
                    .qr-content {
                        flex: 1 1 auto !important;
                        overflow-y: auto !important;
                        -webkit-overflow-scrolling: touch !important;
                    }
                    /* P0: åº•éƒ¨æ ï¼ˆæ°¸è¿œå¯è§ï¼‰- å¼ºåˆ¶ sticky */
                    .qr-bottom-bar {
                        position: sticky !important;
                        bottom: 0 !important;
                        z-index: 1000 !important;
                        display: flex !important;
                        visibility: visible !important;
                        padding-bottom: env(safe-area-inset-bottom, 0px) !important;
                    }
                </style>

                <!-- åŠ è½½ç‚¹é¤é¡µ CSS -->
                <link type="text/css" rel="stylesheet" t-att-href="'/qr_ordering/static/src/css/qr_ordering.css?v=' + (build_version or 'dev')"/>
            </head>
            <body>
                <!-- Boot Guard: é˜²æ­¢ç™½å±çš„å…œåº•æœºåˆ¶ -->
                <div id="qr-boot-guard" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #fff; z-index: 99999; display: flex; align-items: center; justify-content: center; flex-direction: column; padding: 20px;">
                    <div style="text-align: center; max-width: 400px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">ğŸ½ï¸</div>
                        <h1 style="font-size: 24px; margin-bottom: 10px; color: #333;">æ­£åœ¨åŠ è½½...</h1>
                        <p style="color: #666; margin-bottom: 20px;">å¦‚æœ 3 ç§’åä»æœªæ˜¾ç¤ºèœå•ï¼Œè¯·åˆ·æ–°é¡µé¢</p>
                        <p style="font-size: 12px; color: #999;">Build: <t t-esc="build_version or 'unknown'"/></p>
                    </div>
                </div>

                <!-- Debug Panel (only when debug=1) -->
                <t t-if="debug_mode">
                    <div id="qr-debug-panel" style="position: fixed; bottom: 10px; right: 10px; background: rgba(0,0,0,0.85); color: #0f0; padding: 10px; font-size: 11px; font-family: monospace; z-index: 100000; border-radius: 4px; max-width: 300px;">
                        <div style="font-weight: bold; margin-bottom: 5px; color: #fff;">QR Ordering Debug</div>
                        <div>Build: <span id="qr-debug-build"><t t-esc="build_version or 'unknown'"/></span></div>
                        <div>Trace: <span id="qr-debug-trace"><t t-esc="trace_id or 'N/A'"/></span></div>
                        <div>JS: <span id="qr-debug-js">checking...</span></div>
                        <div>API: <span id="qr-debug-api">pending...</span></div>
                    </div>
                </t>

                <!-- ä¸»åº”ç”¨å®¹å™¨ - P0: ä¸‰æ®µå¼å¸ƒå±€ -->
                <div id="qr-ordering-app"
                     class="qr-page"
                     t-att-data-table-token="table.qr_token"
                     t-att-data-access-token="access_token"
                     t-att-data-table-name="table.name"
                     t-att-data-lang="lang">

                    <!-- Header -->
                    <header class="qr-header">
                        <div class="qr-header-left">
                            <span class="qr-table-name" t-esc="table.name"/>
                        </div>
                        <div class="qr-header-center">
                            <span class="qr-logo">ğŸ½ï¸</span>
                        </div>
                        <div class="qr-header-right">
                            <select id="qr-lang-select" class="qr-lang-select">
                                <option value="zh_CN" t-att-selected="lang == 'zh_CN' and 'selected' or None">ä¸­æ–‡</option>
                                <option value="ja_JP" t-att-selected="lang == 'ja_JP' and 'selected' or None">æ—¥æœ¬èª</option>
                                <option value="en_US" t-att-selected="lang == 'en_US' and 'selected' or None">English</option>
                            </select>
                        </div>
                    </header>

                    <!-- Main Content -->
                    <main class="qr-main">
                        <!-- Left Sidebar: Categories -->
                        <aside class="qr-sidebar">
                            <div class="qr-categories" id="qr-categories">
                                <div class="qr-category active" data-category-id="all">
                                    <span class="qr-category-icon">ğŸ“‹</span>
                                    <span class="qr-category-name" data-i18n="all">å…¨éƒ¨</span>
                                </div>
                            </div>
                        </aside>

                        <!-- Right Content: Products -->
                        <section class="qr-content">
                            <div class="qr-search-bar">
                                <input type="text" id="qr-search-input" class="qr-search-input"
                                       placeholder="æœç´¢èœå“..." data-i18n-placeholder="search"/>
                            </div>
                            <div class="qr-products" id="qr-products">
                                <div class="qr-loading">
                                    <div class="qr-spinner"></div>
                                    <p data-i18n="loading">åŠ è½½ä¸­...</p>
                                </div>
                            </div>
                        </section>
                    </main>

                    <!-- åº•éƒ¨æ  - å››æ€çŠ¶æ€æœº -->
                    <footer class="qr-bottom-bar" id="qr-cart-footer">
                        <!-- å·¦ä¾§ï¼šå·²é€‰å›¾æ ‡ + é‡‘é¢/ä»¶æ•° -->
                        <div class="qr-cart-summary" id="qr-cart-summary">
                            <div class="qr-cart-icon" id="qr-cart-icon-btn">
                                <span class="qr-cart-badge" id="qr-cart-badge">0</span>
                                ğŸ½ï¸
                            </div>
                            <div class="qr-cart-info">
                                <span class="qr-cart-amount" id="qr-cart-amount">Â¥0</span>
                                <span class="qr-cart-count" id="qr-cart-count">0 ä»½</span>
                            </div>
                        </div>
                        <!-- ä¸­é—´ï¼šè®¢å•çŠ¶æ€å¾½ç« ï¼ˆå·²ä¸‹å•æ—¶æ˜¾ç¤ºï¼‰ -->
                        <div class="qr-order-status-badge" id="qr-order-status-badge" style="display: none;">
                            <span class="qr-status-text" id="qr-status-text">å·²ä¸‹å• Â· #---</span>
                        </div>
                        <!-- å³ä¾§ï¼šä¸»æ¬¡ä¸¤ä¸ªæŒ‰é’® -->
                        <div class="qr-footer-buttons">
                            <!-- æ¬¡æŒ‰é’®ï¼ˆæŸ¥çœ‹å·²é€‰/æŸ¥çœ‹å·²ç‚¹ï¼‰ -->
                            <button class="qr-cart-btn secondary" id="qr-secondary-btn">æŸ¥çœ‹å·²é€‰</button>
                            <!-- ä¸»æŒ‰é’®ï¼ˆä¸‹å•/è¿½åŠ ä¸‹å•/å»ä¹°å•ï¼‰ -->
                            <button class="qr-cart-btn primary" id="qr-primary-btn" disabled="disabled">ä¸‹å•</button>
                        </div>
                        <!-- çŠ¶æ€ A æç¤ºè¯­ -->
                        <div class="qr-footer-hint" id="qr-footer-hint" style="display: none;">è¯·é€‰æ‹©èœå“</div>
                    </footer>

                    <!-- å‰å°ä¹°å•å¼¹çª— -->
                    <div class="qr-modal" id="qr-pay-modal">
                        <div class="qr-modal-content qr-pay-content">
                            <div class="qr-pay-header">
                                <h2 data-i18n="pay_title">ğŸ’³ å‰å°ä¹°å•</h2>
                                <button class="qr-modal-close" id="qr-pay-close">Ã—</button>
                            </div>
                            <div class="qr-pay-body">
                                <p class="qr-pay-instruction" data-i18n="pay_instruction">è¯·åˆ°å‰å°å‡ºç¤ºä»¥ä¸‹ä¿¡æ¯å®Œæˆä¹°å•</p>
                                <div class="qr-pay-info">
                                    <div class="qr-pay-row">
                                        <span class="qr-pay-label" data-i18n="pay_table">æ¡Œå·</span>
                                        <span class="qr-pay-value" id="qr-pay-table">---</span>
                                        <button class="qr-copy-btn" id="qr-copy-table" data-i18n="copy">å¤åˆ¶</button>
                                    </div>
                                    <div class="qr-pay-row">
                                        <span class="qr-pay-label" data-i18n="pay_order">è®¢å•å·</span>
                                        <span class="qr-pay-value" id="qr-pay-order">---</span>
                                        <button class="qr-copy-btn" id="qr-copy-order" data-i18n="copy">å¤åˆ¶</button>
                                    </div>
                                    <!-- é‡‘é¢æ˜ç»†ï¼šæœªç¨é‡‘é¢ / ç¨é¢ / å«ç¨åˆè®¡ -->
                                    <div class="qr-pay-row qr-pay-amount-row">
                                        <span class="qr-pay-label" data-i18n="pay_subtotal">æœªç¨é‡‘é¢</span>
                                        <span class="qr-pay-value" id="qr-pay-subtotal">Â¥0</span>
                                    </div>
                                    <div class="qr-pay-row qr-pay-amount-row">
                                        <span class="qr-pay-label" data-i18n="pay_tax">ç¨é¢</span>
                                        <span class="qr-pay-value" id="qr-pay-tax">Â¥0</span>
                                    </div>
                                    <div class="qr-pay-row qr-pay-total-row">
                                        <span class="qr-pay-label" data-i18n="pay_total_incl_tax">å«ç¨åˆè®¡</span>
                                        <span class="qr-pay-value qr-pay-amount" id="qr-pay-amount">Â¥0</span>
                                    </div>
                                </div>
                            </div>
                            <div class="qr-pay-footer">
                                <button class="qr-cart-btn secondary" id="qr-pay-done" data-i18n="done">æˆ‘çŸ¥é“äº†</button>
                            </div>
                        </div>
                    </div>

                    <!-- Product Detail Modal -->
                    <div class="qr-modal" id="qr-product-modal">
                        <div class="qr-modal-content">
                            <button class="qr-modal-close" id="qr-modal-close">Ã—</button>
                            <div class="qr-product-detail" id="qr-product-detail"></div>
                        </div>
                    </div>

                    <!-- å·²é€‰èœå“ Modal -->
                    <div class="qr-modal" id="qr-cart-modal">
                        <div class="qr-modal-content qr-cart-content">
                            <div class="qr-cart-header">
                                <h2 data-i18n="cart">å·²é€‰èœå“</h2>
                                <button class="qr-modal-close" id="qr-cart-close">Ã—</button>
                            </div>
                            <div class="qr-cart-items" id="qr-cart-items"></div>
                            <div class="qr-cart-note">
                                <textarea id="qr-cart-note" placeholder="å¤‡æ³¨ï¼ˆå¿Œå£ã€å£å‘³ç­‰ï¼‰..." data-i18n-placeholder="note_placeholder"></textarea>
                            </div>
                            <div class="qr-cart-actions">
                                <div class="qr-cart-total-row">
                                    <span data-i18n="total">å°è®¡</span>:
                                    <span class="qr-cart-total-amount" id="qr-cart-total-amount">Â¥0</span>
                                </div>
                                <button class="qr-submit-btn" id="qr-submit-order-btn" data-i18n="submit_order">ä¸‹å•</button>
                            </div>
                        </div>
                    </div>

                    <!-- å·²ç‚¹èœå“ Modal -->
                    <div class="qr-modal" id="qr-order-modal">
                        <div class="qr-modal-content qr-order-content">
                            <div class="qr-order-header">
                                <h2 data-i18n="my_orders">å·²ç‚¹èœå“</h2>
                                <button class="qr-modal-close" id="qr-order-close">Ã—</button>
                            </div>
                            <div class="qr-order-list" id="qr-order-list"></div>
                            <div class="qr-order-actions">
                                <button class="qr-add-more-btn" id="qr-add-more-btn" data-i18n="add_more">ç»§ç»­ç‚¹é¤</button>
                            </div>
                        </div>
                    </div>

                    <!-- Toast Notification -->
                    <div class="qr-toast" id="qr-toast">
                        <span id="qr-toast-message"></span>
                    </div>

                    <!-- è®¢å•çŠ¶æ€ Toastï¼ˆç‚¹å‡» chip æˆ–ä¸‹å•æˆåŠŸæ—¶å±•ç¤ºï¼‰ -->
                    <div class="qr-order-toast" id="qr-order-toast">
                        <div class="qr-order-toast-header">
                            <div class="qr-order-toast-title">
                                <span class="qr-toast-icon">âœ…</span>
                                <span id="qr-order-toast-title">è®¢å•å·²æäº¤</span>
                            </div>
                            <button class="qr-order-toast-close" id="qr-order-toast-close">Ã—</button>
                        </div>
                        <div class="qr-order-toast-body">
                            <div class="qr-order-toast-row">
                                <span class="qr-order-toast-label">è®¢å•å·</span>
                                <span class="qr-order-toast-value">
                                    <span id="qr-order-toast-ref">---</span>
                                    <button class="qr-order-toast-copy" id="qr-order-toast-copy-ref">å¤åˆ¶</button>
                                </span>
                            </div>
                            <div class="qr-order-toast-row">
                                <span class="qr-order-toast-label">æ¡Œå·</span>
                                <span class="qr-order-toast-value" id="qr-order-toast-table">---</span>
                            </div>
                            <div class="qr-order-toast-row" id="qr-order-toast-hint-row" style="display: none;">
                                <span class="qr-order-toast-label" style="color: #2e7d32;">å¯ç»§ç»­ç‚¹é¤è¿½åŠ åˆ°åŒä¸€è®¢å•</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Boot Guard Script: è¯Šæ–­è„šæœ¬æ‰§è¡ŒçŠ¶æ€ -->
                <script type="text/javascript">
                (function() {
                    'use strict';

                    window.__qrDiag = {
                        qrOrderingLoaded: false,
                        initComplete: false,
                        errors: [],
                        traceId: '<t t-esc="trace_id or 'N/A'"/>'
                    };

                    var bootGuard = document.getElementById('qr-boot-guard');
                    var qrApp = document.getElementById('qr-ordering-app');
                    var debugPanel = document.getElementById('qr-debug-panel');

                    function showBootError(title, detail, errorCode) {
                        window.__qrDiag.errors.push({code: errorCode, title: title, detail: detail, time: new Date().toISOString()});
                        if (!bootGuard) return;
                        bootGuard.innerHTML =
                            '<div style="text-align:center;max-width:400px;padding:20px;">' +
                                '<div style="font-size:48px;margin-bottom:20px;">âš ï¸</div>' +
                                '<h1 style="font-size:20px;margin-bottom:10px;color:#333;">' + title + '</h1>' +
                                '<p style="color:#666;margin-bottom:15px;font-size:14px;">' + detail + '</p>' +
                                '<button onclick="location.reload()" style="padding:12px 24px;background:#ff6b35;color:white;border:none;border-radius:4px;cursor:pointer;font-size:16px;">åˆ·æ–°é¡µé¢</button>' +
                                '<p style="font-size:11px;color:#999;margin-top:20px;">é”™è¯¯ä»£ç : ' + errorCode + '</p>' +
                                '<p style="font-size:11px;color:#999;">Trace ID: ' + window.__qrDiag.traceId + '</p>' +
                            '</div>';
                    }

                    function updateDebug(key, value, isError) {
                        if (!debugPanel) return;
                        var el = document.getElementById('qr-debug-' + key);
                        if (el) {
                            el.textContent = value;
                            el.style.color = isError ? '#ff4444' : '#44ff44';
                        }
                    }

                    function markInitialized() {
                        window.__qrDiag.initComplete = true;
                        if (bootGuard) bootGuard.style.display = 'none';
                        updateDebug('api', 'success', false);
                    }

                    window.addEventListener('qr-ordering-initialized', markInitialized);
                    window.__qrOrderingMarkInit = markInitialized;

                    // 1ç§’åæ£€æŸ¥ JS æ˜¯å¦åŠ è½½
                    setTimeout(function() {
                        var qrLoaded = typeof window.QR_ORDERING_BUILD !== 'undefined';
                        window.__qrDiag.qrOrderingLoaded = qrLoaded;
                        if (!qrLoaded) {
                            updateDebug('js', 'NOT EXECUTED', true);
                            showBootError('ç‚¹é¤è„šæœ¬æœªæ‰§è¡Œ', 'qr_ordering.js æœªèƒ½åŠ è½½æˆ–æ‰§è¡Œ', 'JS_NOT_EXECUTED');
                        } else {
                            updateDebug('js', 'v' + window.QR_ORDERING_BUILD, false);
                        }
                    }, 1000);

                    // 5ç§’åæ£€æŸ¥åˆå§‹åŒ–
                    setTimeout(function() {
                        if (window.__qrDiag.initComplete) return;
                        var diag = window.__qrDiag;
                        if (!diag.qrOrderingLoaded) {
                            showBootError('ç‚¹é¤è„šæœ¬åŠ è½½å¤±è´¥', 'è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•', 'QR_JS_FAILED');
                        } else {
                            showBootError('æ•°æ®åŠ è½½è¶…æ—¶', 'èœå•æ•°æ®è¯·æ±‚è¶…æ—¶ï¼Œè¯·åˆ·æ–°é‡è¯•', 'API_TIMEOUT');
                        }
                        updateDebug('api', 'TIMEOUT', true);
                    }, 5000);

                    window.addEventListener('error', function(e) {
                        var target = e.target;
                        if (target &amp;&amp; target.tagName === 'SCRIPT') {
                            var src = target.src || '';
                            if (src.indexOf('qr_ordering') !== -1) {
                                showBootError('JavaScript åŠ è½½å¤±è´¥', 'ç‚¹é¤è„šæœ¬æ— æ³•åŠ è½½', 'JS_LOAD_ERROR');
                            }
                        }
                    }, true);
                })();
                </script>

                <!-- ç›´æ¥åŠ è½½ç‚¹é¤ JSï¼ˆä¸é€šè¿‡ Odoo assetsï¼‰ -->
                <script type="text/javascript" t-att-src="'/qr_ordering/static/src/js/qr_ordering.js?v=' + (build_version or 'dev')"></script>
            </body>
        </html>
    </template>
    
    <!-- Error Page Template -->
    <template id="error_page" name="QR Ordering Error">
        <t t-call="web.html_container">
            <head>
                <meta charset="UTF-8"/>
                <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
                <title>æ‰«ç ç‚¹é¤ - é”™è¯¯</title>
                <style>
                    * { box-sizing: border-box; margin: 0; padding: 0; }
                    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f5f5f5; min-height: 100vh; display: flex; align-items: center; justify-content: center; }
                    .qr-error-page { width: 100%; max-width: 400px; padding: 40px 20px; text-align: center; }
                    .qr-error-icon { font-size: 64px; margin-bottom: 20px; }
                    .qr-error-title { font-size: 24px; font-weight: 600; color: #333; margin-bottom: 12px; }
                    .qr-error-message { font-size: 16px; color: #666; margin-bottom: 24px; line-height: 1.5; }
                    .qr-error-actions { margin-top: 20px; }
                    .qr-error-actions p { font-size: 14px; color: #666; margin-bottom: 16px; }
                    .qr-btn { display: inline-block; padding: 12px 32px; background: #ff6b35; color: white; text-decoration: none; border-radius: 8px; font-size: 16px; font-weight: 500; }
                    .qr-btn:hover { background: #e55a2b; }
                    .qr-error-trace { font-size: 12px; color: #999; margin-top: 20px; }
                </style>
            </head>
            <body>
                <div class="qr-error-page">
                    <div class="qr-error-icon">
                        <t t-if="error_code == 'TABLE_NOT_FOUND'">ğŸ”</t>
                        <t t-elif="error_code == 'SYSTEM_ERROR'">âš ï¸</t>
                        <t t-else="">ğŸ˜•</t>
                    </div>
                    <h1 class="qr-error-title">
                        <t t-if="error_code == 'TABLE_NOT_FOUND'">é¤æ¡Œä¸å­˜åœ¨</t>
                        <t t-elif="error_code == 'SESSION_OCCUPIED'">è¯¥é¤æ¡Œå·²æœ‰äººåœ¨ç‚¹é¤</t>
                        <t t-elif="error_code == 'SESSION_EXPIRED'">ä¼šè¯å·²è¿‡æœŸ</t>
                        <t t-elif="error_code == 'TABLE_HAS_ORDERS'">è¯¥é¤æ¡Œæœ‰æœªå®Œæˆçš„è®¢å•</t>
                        <t t-elif="error_code == 'SYSTEM_ERROR'">ç³»ç»Ÿç¹å¿™</t>
                        <t t-else="">å‡ºé”™äº†</t>
                    </h1>
                    <p class="qr-error-message" t-esc="error_message"/>
                    <div class="qr-error-actions">
                        <t t-if="error_code in ['SESSION_EXPIRED', 'SESSION_OCCUPIED']">
                            <p>è¯·è”ç³»æœåŠ¡å‘˜ååŠ©</p>
                        </t>
                        <t t-if="error_code == 'TABLE_NOT_FOUND'">
                            <p>æ­¤äºŒç»´ç å¯èƒ½å·²å¤±æ•ˆï¼Œè¯·è”ç³»æœåŠ¡å‘˜è·å–æ–°çš„äºŒç»´ç </p>
                        </t>
                        <a href="javascript:location.reload()" class="qr-btn">é‡è¯•</a>
                    </div>
                    <t t-if="trace_id">
                        <p class="qr-error-trace">
                            é”™è¯¯ID: <t t-esc="trace_id"/>
                        </p>
                    </t>
                </div>
            </body>
        </t>
    </template>
    
    <!-- Print QR Code Page -->
    <template id="print_qr_page" name="Print QR Code">
        <t t-call="web.html_container">
            <div class="qr-print-page">
                <style>
                    .qr-print-page {
                        width: 100%;
                        max-width: 400px;
                        margin: 0 auto;
                        padding: 20px;
                        text-align: center;
                        font-family: Arial, sans-serif;
                    }
                    .qr-print-title {
                        font-size: 24px;
                        font-weight: bold;
                        margin-bottom: 10px;
                    }
                    .qr-print-subtitle {
                        font-size: 14px;
                        color: #666;
                        margin-bottom: 20px;
                    }
                    .qr-print-code {
                        margin: 20px auto;
                    }
                    .qr-print-table-name {
                        font-size: 36px;
                        font-weight: bold;
                        margin: 20px 0;
                        padding: 10px;
                        border: 3px solid #000;
                        display: inline-block;
                    }
                    .qr-print-instruction {
                        font-size: 16px;
                        margin-top: 20px;
                    }
                    @media print {
                        .no-print { display: none; }
                    }
                </style>
                
                <div class="qr-print-title">æ‰«ç ç‚¹é¤</div>
                <div class="qr-print-subtitle">Scan to Order</div>
                
                <div class="qr-print-code">
                    <!-- QR Code Image - ä»æ§åˆ¶å™¨ä¼ å…¥å®Œæ•´ URL -->
                    <img t-att-src="barcode_url" width="300" height="300" alt="QR Code"/>
                    <div style="font-size: 10px; color: #666; margin-top: 5px; word-break: break-all;" t-esc="qr_content_url"/>
                </div>
                
                <div class="qr-print-table-name" t-esc="table.name"/>
                
                <div class="qr-print-instruction">
                    è¯·æ‰«æäºŒç»´ç ç‚¹é¤<br/>
                    Please scan to order
                </div>
                
                <div class="no-print" style="margin-top: 30px;">
                    <button onclick="window.print()" class="btn btn-primary">æ‰“å° Print</button>
                </div>
            </div>
        </t>
    </template>

    <!--
        V2 Ordering Page Template - Mobile-first Extreme Experience
        Features: Pinned video carousel, Reco rail with PiP, Sticky chips, 2-col grid with stepper
        Use with feature flag: menu_ui_v2=1
    -->
    <template id="ordering_page_v2" name="QR Ordering Page V2">
        <t t-set="html_data" t-value="{}"/>
        <html>
            <head>
                <meta charset="utf-8"/>
                <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
                <meta name="theme-color" content="#ff6b35"/>
                <meta name="format-detection" content="telephone=no"/>
                <title>æ‰«ç ç‚¹é¤</title>
                <link type="text/css" rel="stylesheet" t-att-href="'/qr_ordering/static/src/css/qr_ordering_v2.css?v=' + (build_version or 'dev')"/>
            </head>
            <body>
                <!-- Boot Guard -->
                <div id="qr-boot-guard" style="position: fixed; inset: 0; background: #fff; z-index: 99999; display: flex; align-items: center; justify-content: center; flex-direction: column; padding: 20px;">
                    <div style="text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 20px;">ğŸ½ï¸</div>
                        <h1 style="font-size: 20px; margin-bottom: 10px; color: #333;">æ­£åœ¨åŠ è½½...</h1>
                        <p style="color: #666; font-size: 14px;">Build: <t t-esc="build_version or 'unknown'"/></p>
                    </div>
                </div>

                <!-- Main App Container -->
                <div id="qr-ordering-app"
                     class="qr-page-v2"
                     t-att-data-table-token="table.qr_token"
                     t-att-data-access-token="access_token"
                     t-att-data-table-name="table.name"
                     t-att-data-lang="lang">

                    <!-- Header -->
                    <header class="qr-header-v2">
                        <div>
                            <div class="qr-header-title" t-esc="table.name"/>
                            <div class="qr-header-subtitle">æ‰«ç ç‚¹é¤</div>
                        </div>
                        <select id="qr-lang-select" class="qr-lang-select">
                            <option value="zh_CN" t-att-selected="lang == 'zh_CN' and 'selected' or None">ä¸­æ–‡</option>
                            <option value="ja_JP" t-att-selected="lang == 'ja_JP' and 'selected' or None">æ—¥æœ¬èª</option>
                            <option value="en_US" t-att-selected="lang == 'en_US' and 'selected' or None">English</option>
                        </select>
                    </header>

                    <!-- Search Bar -->
                    <div class="qr-search-bar">
                        <input type="text" id="qr-search-input" class="qr-search-input" placeholder="æœç´¢èœå“..."/>
                    </div>

                    <!-- Main Content (scrollable) -->
                    <main class="qr-main-v2">
                        <!-- Pinned Video Carousel -->
                        <section class="qr-pinned-carousel" id="qr-pinned-carousel" style="display:none;">
                            <!-- Rendered by JS -->
                        </section>

                        <!-- Recommendation Rail -->
                        <section class="qr-reco-rail" id="qr-reco-rail" style="display:none;">
                            <!-- Rendered by JS -->
                        </section>

                        <!-- Category Chips (sticky) -->
                        <div class="qr-category-chips" id="qr-category-chips">
                            <button class="qr-chip active" data-category-id="all">å…¨éƒ¨</button>
                        </div>

                        <!-- Product Grid -->
                        <div class="qr-product-grid" id="qr-product-grid">
                            <div class="qr-loading">
                                <div class="qr-spinner"></div>
                                <p>åŠ è½½ä¸­...</p>
                            </div>
                        </div>
                    </main>

                    <!-- Cart Bar (fixed bottom) -->
                    <footer class="qr-cart-bar" id="qr-cart-bar">
                        <div class="qr-cart-summary">
                            <div class="qr-cart-icon">
                                ğŸ›’
                                <span class="qr-cart-badge" id="qr-cart-badge">0</span>
                            </div>
                            <span class="qr-cart-total" id="qr-cart-amount">Â¥0</span>
                        </div>
                        <button class="qr-cart-btn" id="qr-cart-btn" disabled="disabled">æŸ¥çœ‹è®¢å• â†’</button>
                    </footer>

                    <!-- Product Detail Modal -->
                    <div class="qr-modal" id="qr-product-modal">
                        <div class="qr-modal-content">
                            <div class="qr-modal-header">
                                <h2>èœå“è¯¦æƒ…</h2>
                                <button class="qr-modal-close">Ã—</button>
                            </div>
                            <div class="qr-modal-body">
                                <!-- Rendered by JS -->
                            </div>
                        </div>
                    </div>

                    <!-- Cart Modal -->
                    <div class="qr-modal" id="qr-cart-modal">
                        <div class="qr-modal-content">
                            <div class="qr-modal-header">
                                <h2>è´­ç‰©è½¦</h2>
                                <button class="qr-modal-close">Ã—</button>
                            </div>
                            <div class="qr-modal-body">
                                <div class="qr-cart-list" id="qr-cart-list"></div>
                                <div class="qr-cart-note">
                                    <textarea id="qr-cart-note" placeholder="å¤‡æ³¨ï¼ˆå¿Œå£ã€å£å‘³ç­‰ï¼‰..."></textarea>
                                </div>
                            </div>
                            <div class="qr-cart-actions">
                                <div class="qr-cart-total-row">
                                    <span>åˆè®¡</span>
                                    <span class="qr-cart-total-amount">Â¥0</span>
                                </div>
                                <button class="qr-submit-btn" id="qr-submit-order-btn">æäº¤è®¢å•</button>
                            </div>
                        </div>
                    </div>

                    <!-- Order Modal -->
                    <div class="qr-modal" id="qr-order-modal">
                        <div class="qr-modal-content">
                            <div class="qr-modal-header">
                                <h2>æˆ‘çš„è®¢å•</h2>
                                <button class="qr-modal-close">Ã—</button>
                            </div>
                            <div class="qr-modal-body">
                                <div class="qr-order-list" id="qr-order-list"></div>
                            </div>
                            <div class="qr-order-actions">
                                <button class="qr-add-more-btn" id="qr-add-more-btn">ç»§ç»­ç‚¹é¤</button>
                            </div>
                        </div>
                    </div>

                    <!-- Toast -->
                    <div class="qr-toast" id="qr-toast">
                        <span class="qr-toast-message"></span>
                    </div>
                </div>

                <!-- V2 JavaScript -->
                <script type="text/javascript" t-att-src="'/qr_ordering/static/src/js/qr_ordering_v2.js?v=' + (build_version or 'dev')"></script>
            </body>
        </html>
    </template>

</odoo>

