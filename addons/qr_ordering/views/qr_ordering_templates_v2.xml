<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="ordering_page_v2" name="QR Ordering Page V2 - Mobile Optimized">
        <t t-set="html_data" t-value="{}"/>
        <html>
            <head>
                <meta charset="utf-8"/>
                <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
                <meta name="mobile-web-app-capable" content="yes"/>
                <meta name="apple-mobile-web-app-capable" content="yes"/>
                <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
                
                <!-- V2 ÁßªÂä®Á´ØÊûÅËá¥‰ΩìÈ™åÁâà CSS -->
                <link type="text/css" rel="stylesheet" t-att-href="'/qr_ordering/static/src/css/qr_ordering_v2.css?v=' + (build_version or 'dev')"/>
                
                <!-- Inline Critical CSS -->
                <style type="text/css">
                    <![CDATA[
                    /* Critical CSS for V2 */
                    html, body {
                        height: 100%;
                        margin: 0;
                        padding: 0;
                        overflow-x: hidden;
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                        background: #f5f5f5;
                        -webkit-font-smoothing: antialiased;
                    }
                    #qr-app-v2 {
                        width: 100%;
                        min-height: 100vh;
                        min-height: 100dvh;
                        display: flex;
                        flex-direction: column;
                        position: relative;
                    }
                    /* Boot Guard */
                    #qr-boot-guard {
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: #fff;
                        z-index: 99999;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    }
                    ]]>
                </style>
                
                <title>Êâ´Á†ÅÁÇπÈ§ê V2</title>
            </head>

            <body class="qr-ordering-v2">
                <!-- Boot Guard -->
                <div id="qr-boot-guard">
                    <div style="text-align: center; padding: 20px;">
                        <div class="qr-spinner" style="width: 40px; height: 40px; border: 3px solid #f3f3f3; border-top: 3px solid #ff6b6b; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
                        <h1 style="font-size: 20px; margin-bottom: 10px; color: #333;">Ê≠£Âú®Âä†ËΩΩ...</h1>
                        <p style="color: #666; font-size: 14px;">Build: <t t-esc="build_version or 'unknown'"/></p>
                    </div>
                </div>

                <!-- Main App Container -->
                <div id="qr-app-v2"
                     t-att-data-table-token="table.qr_token"
                     t-att-data-access-token="access_token"
                     t-att-data-table-name="table.name"
                     t-att-data-lang="lang">

                    <!-- Header: Â∫óÂêç/Ê°åÂè∑ + ÊêúÁ¥¢ -->
                    <header class="qr-v2-header">
                        <div class="qr-v2-header-top">
                            <div class="qr-v2-header-left">
                                <div class="qr-v2-store-name">üçΩÔ∏è È§êÂéÖÂêçÁß∞</div>
                                <div class="qr-v2-table-name" t-esc="table.name"/>
                            </div>
                            <div class="qr-v2-header-right">
                                <select id="qr-v2-lang-select" class="qr-v2-lang-select">
                                    <option value="zh_CN" t-att-selected="lang == 'zh_CN' and 'selected' or None">‰∏≠Êñá</option>
                                    <option value="ja_JP" t-att-selected="lang == 'ja_JP' and 'selected' or None">Êó•Êú¨Ë™û</option>
                                    <option value="en_US" t-att-selected="lang == 'en_US' and 'selected' or None">EN</option>
                                </select>
                            </div>
                        </div>
                        <div class="qr-v2-search-bar">
                            <input type="text" 
                                   id="qr-v2-search-input" 
                                   class="qr-v2-search-input"
                                   placeholder="ÊêúÁ¥¢ËèúÂìÅ..." />
                        </div>
                    </header>

                    <!-- Pinned Carousel: ÁΩÆÈ°∂ËßÜÈ¢ëËΩÆÊí≠ -->
                    <section class="qr-v2-pinned-carousel" id="qr-v2-pinned-carousel" style="display: none;">
                        <div class="qr-v2-carousel-container">
                            <div class="qr-v2-carousel-track" id="qr-v2-carousel-track">
                                <!-- Slides will be injected by JS -->
                            </div>
                            <div class="qr-v2-carousel-controls">
                                <div class="qr-v2-carousel-dots" id="qr-v2-carousel-dots"></div>
                                <div class="qr-v2-carousel-badges">
                                    <span class="qr-v2-badge">üîá</span>
                                    <span class="qr-v2-badge">AUTO</span>
                                </div>
                            </div>
                            <div class="qr-v2-carousel-progress" id="qr-v2-carousel-progress"></div>
                        </div>
                    </section>

                    <!-- Reco Rail: Êé®ËçêÊ®™ÂêëÊªëÂä® -->
                    <section class="qr-v2-reco-rail" id="qr-v2-reco-rail" style="display: none;">
                        <div class="qr-v2-reco-header">
                            <h2 class="qr-v2-reco-title">üî• ‰ªäÊó•Êé®Ëçê</h2>
                        </div>
                        <div class="qr-v2-reco-scroll" id="qr-v2-reco-scroll">
                            <!-- Reco cards will be injected by JS -->
                        </div>
                    </section>

                    <!-- Sticky Category Chips -->
                    <section class="qr-v2-category-chips" id="qr-v2-category-chips">
                        <div class="qr-v2-chips-scroll" id="qr-v2-chips-scroll">
                            <!-- Category chips will be injected by JS -->
                        </div>
                    </section>

                    <!-- Product Grid: ‰∏§ÂàóÂïÜÂìÅ -->
                    <section class="qr-v2-product-grid" id="qr-v2-product-grid">
                        <!-- Product cards will be injected by JS -->
                        <div class="qr-v2-loading">
                            <div class="qr-spinner"></div>
                            <p>Âä†ËΩΩ‰∏≠...</p>
                        </div>
                    </section>

                    <!-- Bottom Cart Bar: Âõ∫ÂÆöÂ∫ïÊ†è -->
                    <footer class="qr-v2-bottom-bar" id="qr-v2-bottom-bar">
                        <div class="qr-v2-cart-summary">
                            <div class="qr-v2-cart-icon">
                                <span class="qr-v2-cart-badge" id="qr-v2-cart-badge">0</span>
                                üõí
                            </div>
                            <div class="qr-v2-cart-info">
                                <div class="qr-v2-cart-items" id="qr-v2-cart-items">0 ‰ª∂</div>
                                <div class="qr-v2-cart-total" id="qr-v2-cart-total">¬•0</div>
                            </div>
                        </div>
                        <button class="qr-v2-review-btn" id="qr-v2-review-btn">
                            Êü•ÁúãËÆ¢Âçï ‚Üí
                        </button>
                    </footer>

                    <!-- PiP Video Overlay -->
                    <div class="qr-v2-pip-overlay" id="qr-v2-pip-overlay" style="display: none;">
                        <div class="qr-v2-pip-container">
                            <video id="qr-v2-pip-video" 
                                   class="qr-v2-pip-video" 
                                   playsinline="playsinline" 
                                   webkit-playsinline="webkit-playsinline"
                                   preload="metadata"></video>
                            <div class="qr-v2-pip-controls">
                                <button class="qr-v2-pip-btn" id="qr-v2-pip-play">‚ñ∂</button>
                                <button class="qr-v2-pip-btn" id="qr-v2-pip-mute">üîá</button>
                                <button class="qr-v2-pip-btn qr-v2-pip-close" id="qr-v2-pip-close">‚úï</button>
                            </div>
                        </div>
                    </div>

                    <!-- Cart Modal -->
                    <div class="qr-v2-modal" id="qr-v2-cart-modal">
                        <div class="qr-v2-modal-content">
                            <div class="qr-v2-modal-header">
                                <h2>Ë¥≠Áâ©ËΩ¶</h2>
                                <button class="qr-v2-modal-close" id="qr-v2-cart-close">‚úï</button>
                            </div>
                            <div class="qr-v2-modal-body" id="qr-v2-cart-items-list">
                                <!-- Cart items -->
                            </div>
                            <div class="qr-v2-modal-footer">
                                <div class="qr-v2-cart-total-row">
                                    <span>ÂêàËÆ°</span>
                                    <span id="qr-v2-cart-modal-total">¬•0</span>
                                </div>
                                <button class="qr-v2-btn-primary" id="qr-v2-checkout-btn">Êèê‰∫§ËÆ¢Âçï</button>
                            </div>
                        </div>
                    </div>

                    <!-- Orders Modal -->
                    <div class="qr-v2-modal" id="qr-v2-orders-modal">
                        <div class="qr-v2-modal-content">
                            <div class="qr-v2-modal-header">
                                <h2>Â∑≤‰∏ãÂçï</h2>
                                <button class="qr-v2-modal-close" id="qr-v2-orders-close">‚úï</button>
                            </div>
                            <div class="qr-v2-modal-body" id="qr-v2-orders-list">
                                <!-- Orders -->
                            </div>
                        </div>
                    </div>

                    <!-- Toast -->
                    <div class="qr-v2-toast" id="qr-v2-toast"></div>
                </div>

                <!-- Scripts -->
                <script type="text/javascript" t-att-src="'/qr_ordering/static/src/js/qr_ordering_v2.js?v=' + (build_version or 'dev')"/>
                
                <!-- Spinner animation -->
                <style>
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                </style>

                <!-- Inline Boot Script -->
                <script>
                    <![CDATA[
                    // Remove boot guard after 3s or when page loads
                    const bootGuard = document.getElementById('qr-boot-guard');
                    let removed = false;

                    function removeBootGuard() {
                        if (!removed && bootGuard) {
                            removed = true;
                            bootGuard.style.opacity = '0';
                            bootGuard.style.transition = 'opacity 0.3s';
                            setTimeout(() => bootGuard.remove(), 300);
                        }
                    }

                    // Auto remove after 3s
                    setTimeout(removeBootGuard, 3000);

                    // Remove when QR Ordering V2 initializes
                    window.addEventListener('qr-v2-ready', removeBootGuard);

                    // Fallback: DOMContentLoaded
                    if (document.readyState === 'complete') {
                        setTimeout(removeBootGuard, 500);
                    } else {
                        window.addEventListener('load', () => setTimeout(removeBootGuard, 500));
                    }
                    ]]>
                </script>
            </body>
        </html>
    </template>
</odoo>

