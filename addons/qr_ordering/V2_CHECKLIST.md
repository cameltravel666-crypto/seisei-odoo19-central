# QR Ordering V2 - 自测清单

## 📋 部署前检查

- [ ] 所有文件已创建并提交
- [ ] `__manifest__.py` 已更新
- [ ] `qr_ordering_controller.py` 已添加 feature flag
- [ ] 无 linter 错误
- [ ] 本地测试通过

---

## 🧪 iPhone 尺寸测试

### 布局基础
- [ ] 页面不横向溢出
- [ ] 页面不纵向挤压
- [ ] 底栏不被遮挡（Safe area 生效）
- [ ] 地址栏收起/出现时不白屏
- [ ] 地址栏收起/出现时不明显跳动

### Header
- [ ] 店名/桌号显示正常
- [ ] 搜索框可用
- [ ] 语言切换可用

---

## 🎥 PinnedCarousel 测试

### 基础功能
- [ ] 有 `qr_pinned=True` 且有 `video_url` 的商品显示轮播
- [ ] 无符合条件商品时不显示（`display: none`）
- [ ] 轮播自动切换（4-6 秒）

### 视频播放
- [ ] 视频默认静音播放
- [ ] 仅当前 slide 播放
- [ ] 切换时前一个视频停止
- [ ] Autoplay 失败时显示封面（poster）
- [ ] 视频循环播放（`loop`）

### 控件
- [ ] Dots 指示器同步当前 slide
- [ ] 点击 Dots 切换 slide
- [ ] 进度条动画正常（5 秒循环）
- [ ] 🔇 和 AUTO 标识显示

### 步进器
- [ ] 步进器显示当前数量
- [ ] 点击 + 加购，数量更新
- [ ] 点击 - 减少，数量更新（最小 0）
- [ ] 步进器操作不触发 slide 切换

---

## 🔥 RecoRail + PiP 测试

### RecoRail
- [ ] 有 `qr_highlight=True` 的商品显示推荐
- [ ] 无符合条件商品时不显示（`display: none`）
- [ ] 横向滑动流畅
- [ ] 有视频的卡片显示 ▶ 图标
- [ ] 点击卡片打开 PiP

### PiP Overlay
- [ ] 点击推荐卡片打开 PiP
- [ ] PiP 显示在右下角
- [ ] PiP 不遮挡底栏（上移）
- [ ] 视频默认静音播放

### PiP 控件
- [ ] Play/Pause 按钮切换播放状态
- [ ] Mute 按钮切换静音状态（🔇 ↔️ 🔊）
- [ ] Close 按钮关闭 PiP
- [ ] 关闭时视频停止并释放资源

### 单实例
- [ ] 同一时间只能打开一个 PiP
- [ ] 打开新 PiP 时自动关闭前一个

---

## 🏷️ StickyCategoryChips 测试

### 吸顶效果
- [ ] Chips 行吸顶（Header 下方）
- [ ] 滚动时始终可见
- [ ] Z-index 正确（不被其他元素遮挡）

### 交互
- [ ] 横向滑动流畅
- [ ] 点击 chip 切换分类
- [ ] Active chip 高亮显示
- [ ] 切换后商品列表更新

### 响应式
- [ ] 所有分类都可见（横向滚动）
- [ ] "全部" chip 默认激活
- [ ] 小屏幕不折行

---

## 🛒 ProductGrid 测试

### 布局
- [ ] iPhone 11+ 显示两列
- [ ] iPhone SE 显示单列（≤ 375px）
- [ ] 卡片间距均匀（12px gap）
- [ ] 图片 1:1 不变形

### 商品卡片
- [ ] 商品名称显示（最多 2 行省略）
- [ ] 价格显示（含税）
- [ ] 推荐商品显示"推荐"徽章
- [ ] 图片加载正常

### 步进器
- [ ] 未加购时只显示 + 按钮
- [ ] 已加购时显示 - 数量 + 按钮
- [ ] 点击 + 加购，数量更新
- [ ] 点击 - 减少，数量更新
- [ ] 步进器操作不触发卡片点击

### 分类过滤
- [ ] 选择分类后只显示该分类商品
- [ ] "全部" 显示所有商品
- [ ] 商品数量正确

---

## 🛍️ BottomCartBar 测试

### 固定定位
- [ ] 底栏固定在底部
- [ ] 滚动时不移动
- [ ] 不遮挡商品（页面有足够 padding-bottom）

### Safe Area
- [ ] iPhone X+ 底部留白正常
- [ ] 横屏时也正常显示
- [ ] 其他设备不受影响

### 内容显示
- [ ] 购物车图标显示
- [ ] 徽章显示件数（红色圆点）
- [ ] 显示 "X 件"
- [ ] 显示总金额 "¥XXX"
- [ ] "查看订单 →" 按钮显示

### 实时更新
- [ ] 加购后件数立即更新
- [ ] 加购后金额立即更新
- [ ] 减少后件数立即更新
- [ ] 减少后金额立即更新

### 空购物车
- [ ] 空购物车时显示 "0 件" 和 "¥0"
- [ ] 空购物车时按钮禁用（灰色）
- [ ] 空购物车时按钮仍可见（不隐藏）

---

## 📦 购物车 Modal 测试

### 打开 Modal
- [ ] 点击 "查看订单 →" 打开 Modal
- [ ] Modal 从底部滑入
- [ ] 背景遮罩显示
- [ ] 背景滚动锁定

### 内容显示
- [ ] 显示所有购物车商品
- [ ] 显示商品名称
- [ ] 显示单价 × 数量
- [ ] 显示小计
- [ ] 显示总金额

### 交互
- [ ] 点击 × 关闭 Modal
- [ ] 点击遮罩关闭 Modal
- [ ] 点击 "提交订单" 提交
- [ ] 提交成功后 Modal 关闭
- [ ] 提交成功后购物车清空

### 空购物车
- [ ] 空购物车时显示 "购物车是空的"

---

## 🔍 搜索测试

### 基础功能
- [ ] 输入关键词实时过滤
- [ ] 搜索商品名称
- [ ] 搜索商品描述
- [ ] 不区分大小写

### 结果显示
- [ ] 有结果时显示匹配商品
- [ ] 无结果时显示 "未找到相关菜品"
- [ ] 清空搜索框恢复全部商品

---

## 📱 兼容性测试

### iPhone
- [ ] iPhone 15/14 (iOS 17)
- [ ] iPhone SE (小屏)
- [ ] iPhone X+ (Safe area)
- [ ] Safari 浏览器

### 微信浏览器
- [ ] 微信 iOS
- [ ] 微信 Android

### Android
- [ ] Chrome Mobile
- [ ] 主流 Android 手机

### Desktop（降级）
- [ ] Chrome Desktop 显示正常
- [ ] 可能非最优但不应崩溃

---

## ⚡ 性能测试

### 加载速度
- [ ] 首屏 < 2 秒（4G 网络）
- [ ] BootGuard 3 秒内消失
- [ ] 图片逐步加载
- [ ] 视频延迟加载

### 流畅度
- [ ] 滚动流畅（60fps）
- [ ] 横滑流畅（RecoRail, CategoryChips）
- [ ] 轮播切换流畅
- [ ] 步进器响应灵敏

### 资源占用
- [ ] 内存占用合理（< 100MB）
- [ ] CPU 占用合理（< 30%）
- [ ] 视频暂停时释放资源

---

## 🔄 完整流程测试

### 标准点餐流程
1. [ ] 扫码进入页面（V2）
2. [ ] 看到 PinnedCarousel（如有）
3. [ ] 看到 RecoRail（如有）
4. [ ] 浏览商品（CategoryChips + ProductGrid）
5. [ ] 点击步进器加购商品
6. [ ] 底栏显示件数和金额
7. [ ] 点击 "查看订单 →"
8. [ ] 查看购物车明细
9. [ ] 点击 "提交订单"
10. [ ] 订单提交成功
11. [ ] 购物车清空
12. [ ] Toast 提示 "订单已提交！"

### 加菜流程
1. [ ] 已有订单后继续浏览
2. [ ] 再次加购商品
3. [ ] 提交第二份订单
4. [ ] 可在 "已下单" 查看历史订单

### 视频体验流程
1. [ ] PinnedCarousel 自动播放
2. [ ] 切换 slide 查看更多视频
3. [ ] 在 RecoRail 点击有视频的商品
4. [ ] PiP 打开并播放
5. [ ] 使用 Play/Pause/Mute 控件
6. [ ] 关闭 PiP

---

## 🐛 边界情况测试

### 无数据
- [ ] 无 pinned 商品时不显示 Carousel
- [ ] 无 highlight 商品时不显示 RecoRail
- [ ] 无商品时显示空状态
- [ ] 空购物车时显示 "购物车是空的"

### 网络异常
- [ ] API 失败时显示 Toast
- [ ] 网络慢时显示 Loading
- [ ] 重试机制生效

### 长文本
- [ ] 商品名称过长省略（2 行）
- [ ] 描述过长省略（1 行）
- [ ] 分类名称过长横滑

### 极端数量
- [ ] 大量商品（100+）滚动正常
- [ ] 购物车大量商品显示正常
- [ ] 数量 > 99 显示正常

---

## ✅ 最终检查

部署前确认：
- [ ] 所有核心功能测试通过
- [ ] iPhone + 微信浏览器测试通过
- [ ] 无明显性能问题
- [ ] 无 Console 错误
- [ ] Feature flag 可正常切换 V1/V2
- [ ] 文档完整（README, DEPLOY, SUMMARY）

**全部通过 ✅ → 可以部署！🚀**

---

**测试人**: _____________  
**测试时间**: _____________  
**测试环境**: _____________  
**测试结果**: ⭕ 通过 / ❌ 失败



