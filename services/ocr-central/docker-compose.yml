version: '3.8'

services:
  ocr-service:
    build: .
    container_name: ocr-service
    restart: unless-stopped
    ports:
      - "8180:8080"
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - OCR_DATABASE_URL=postgresql://ocr:${OCR_DB_PASSWORD:-ocr}@ocr-db:5432/ocr_service
      - OCR_SERVICE_KEY=${OCR_SERVICE_KEY}
      - OCR_FREE_QUOTA=${OCR_FREE_QUOTA:-30}
      - OCR_PRICE_PER_IMAGE=${OCR_PRICE_PER_IMAGE:-20}
    depends_on:
      - ocr-db
    networks:
      - ocr-network

  ocr-db:
    image: postgres:15-alpine
    container_name: ocr-db
    restart: unless-stopped
    environment:
      - POSTGRES_USER=ocr
      - POSTGRES_PASSWORD=${OCR_DB_PASSWORD:-ocr}
      - POSTGRES_DB=ocr_service
    volumes:
      - ocr-db-data:/var/lib/postgresql/data
    networks:
      - ocr-network

volumes:
  ocr-db-data:

networks:
  ocr-network:
    driver: bridge
